# Развёртывание коммутируемой сети с резервными каналами

----

## Задание:

* Создание сети и настройка основных параметров устройства.
* Выбор корневого моста.
* Наблюдение за процессом выбора протоклом STP порта, исходя из стоимости портов.
* Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов.


### Схема реализации (EVE-NG)

![Scheme.png](img%2FScheme.png)

Базовая настройка коммутаторов SW1, SW2, SW3 приведена по [ссылке](Configs).

#### Проверка связности между коммутаторами

![ping_S1-S2-S3.png](img%2Fping_S1-S2-S3.png)

![ping_S2-S3.png](img%2Fping_S2-S3.png)

### Изначальные данные протокола STP

Вывод команды ***show spanning-tree*** на коммутаторах:

![SW1_first_state.png](img%2FSW1_first_state.png)

![SW2_first_state.png](img%2FSW2_first_state.png)

![SW3_first_state.png](img%2FSW3_first_state.png)

Текущая схема сети:

![Start state.png](img%2FStart%20state.png)

С учетом выходных данных, поступающих с коммутаторов, ответьте на следующие вопросы.\

Какой коммутатор является корневым мостом?\
*Корневым мостом является коммутатор SW1.*

Почему этот коммутатор был выбран протоколом spanning-tree в качестве корневого моста?\
*Поскольку все коммутаторы в данной схеме имеют одинаковые значения приоритета и расширенного идентификатора системы в качестве корневого моста выбран коммутатор с наименьшим MAC-адресом - SW1.*

Какие порты на коммутаторе являются корневыми портами?\
*Корневые порты – имеют минимальную стоимость маршрута к корневому мосту.
На данной схеме:\
SW2: Et0/1\
SW3: Et0/3*

Какие порты на коммутаторе являются назначенными портами?\
*Назначенные порты имеют наименьшую стоимость пути к корневому мосту.
На данной схеме:\
SW1: Et0/1, Et0/3\
SW2: Et0/3*

Какой порт отображается в качестве альтернативного и в настоящее время заблокирован?

*На данной схеме альтернетивным портом является:\
SW3: Et0/1*

Почему протокол spanning-tree выбрал этот порт в качестве невыделенного (заблокированного) порта?

*Имея несколько путей равной стоимости к корневому мосту, коммутатор определяет роли портов исходя из критериев:*
* *самое низкое значение BID – соседнего коммутатора;*
* *самое низкое значение PID – порта соседнего коммутатора.*
  
*BID коммутатора SW3 выше, чем SW2, так как значение MAC-адреса больше, поэтому порт Et0/3 на коммутаторе SW2 в сторону SW3 является назначенным, а встречный порт на SW2 Et0/1 – альтернативным.*

#### Изменение стоимости порта

Изменим стоимость корневого порта на SW3, установив значение 18 вместо 100.
Проверим текущее состояние портов на некорневых коммутаторах.\

![SW3_second_state.png](img%2FSW3_second_state.png)

![SW2_second_state.png](img%2FSW2_second_state.png)

На изображениях видно, что порт Et0/1 на SW3 стал назначенным, а Et0/1 на 
SW2 - альтернативном. Данная смена ролей портов связана с изменением стоимости
пути к корневому мосту RPC: RPC с коммутатора SW2 Et0/1 через SW3 Et0/1 
составляет 118, а в обратную стоимость с SW3 Et0/1 через SW2 Et0/1 200.
При удалении изменения стоиомсти порта схема вернулась в исходное состояние.

### Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов

При поднятии избыточных линков получаем следующие данные:

![SW1_third_state.png](img%2FSW1_third_state.png)

![SW2_third_state.png](img%2FSW2_third_state.png)

![SW3_third_state.png](img%2FSW3_third_state.png)

Какой порт выбран протоколом STP в качестве порта корневого моста 
на каждом коммутаторе некорневого моста?\
*SW2: Et0/2\
SW3: Et0/2*

Почему протокол STP выбрал эти порты в качестве портов корневого моста
на этих коммутаторах?\
*При наличии избыточных портов между корневым мостом и некорневым
коммутатором и условии, что RPC одинаков, в качестве корневого выбирается
 порт с меньшим приоритетом PID.*

### Вопросы для повторения

1. Какое значение протокол STP использует первым после выбора корневого моста, чтобы определить выбор порта?\
*Root Path Cost - RPC.*
2. Если первое значение на двух портах одинаково, какое следующее значение будет использовать протокол STP при выборе порта?\
*Bridge ID*
3. Если оба значения на двух портах равны, каким будет следующее значение, которое использует протокол STP при выборе порта?
*Port ID*